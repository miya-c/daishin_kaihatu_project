<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ—å‚ç…§æ¤œè¨¼ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Helvetica Neue', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .validation-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e1e1e1;
            border-radius: 6px;
        }
        .validation-section.success {
            border-color: #4CAF50;
            background-color: #f8fff8;
        }
        .validation-section.error {
            border-color: #f44336;
            background-color: #fff8f8;
        }
        .validation-section.warning {
            border-color: #ff9800;
            background-color: #fffcf8;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
        }
        .column-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .column-list {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }
        .column-list h4 {
            margin-top: 0;
            color: #2196F3;
        }
        .column-item {
            padding: 5px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
        }
        .match { color: #4CAF50; }
        .mismatch { color: #f44336; font-weight: bold; }
        .missing { color: #ff9800; font-style: italic; }
        .status-icon {
            display: inline-block;
            width: 20px;
            text-align: center;
        }
        .summary {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .recommendation {
            background: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }
        .test-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px 0 0;
        }
        .test-button:hover {
            background: #1976D2;
        }
        .code-suggestion {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            white-space: pre-wrap;
            border-left: 4px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆåˆ—å‚ç…§æ¤œè¨¼ãƒ„ãƒ¼ãƒ«</h1>
        <p>CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿéš›ã®åˆ—æ§‹é€ ã¨ç‰©ä»¶.gsã®åˆ—å‚ç…§ã‚³ãƒ¼ãƒ‰ã‚’æ¯”è¼ƒæ¤œè¨¼ã—ã¾ã™ã€‚</p>

        <button class="test-button" onclick="validateColumns()">åˆ—å‚ç…§ã‚’æ¤œè¨¼</button>
        <button class="test-button" onclick="testAPI()">APIæ¥ç¶šãƒ†ã‚¹ãƒˆ</button>

        <div id="validationResults"></div>

        <div class="validation-section">
            <h2>ğŸ—‚ï¸ å®Ÿéš›ã®CSVãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ </h2>
            <div class="column-comparison">
                <div class="column-list">
                    <h4>ç‰©ä»¶ãƒã‚¹ã‚¿.csv</h4>
                    <div class="column-item">ç‰©ä»¶ID (åˆ—A, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹0)</div>
                    <div class="column-item">ç‰©ä»¶å (åˆ—B, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1)</div>
                    <div class="column-item">æ¤œé‡å®Œäº†æ—¥ (åˆ—C, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹2)</div>
                </div>
                <div class="column-list">
                    <h4>éƒ¨å±‹ãƒã‚¹ã‚¿.csv</h4>
                    <div class="column-item">ç‰©ä»¶ID (åˆ—A, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹0)</div>
                    <div class="column-item">éƒ¨å±‹ID (åˆ—B, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1)</div>
                    <div class="column-item">éƒ¨å±‹å (åˆ—C, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹2)</div>
                </div>
                <div class="column-list">
                    <h4>inspection_data.csv</h4>
                    <div class="column-item">è¨˜éŒ²ID (åˆ—A, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹0)</div>
                    <div class="column-item">ç‰©ä»¶å (åˆ—B, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1)</div>
                    <div class="column-item">ç‰©ä»¶ID (åˆ—C, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹2)</div>
                    <div class="column-item">éƒ¨å±‹ID (åˆ—D, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹3)</div>
                    <div class="column-item">éƒ¨å±‹å (åˆ—E, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹4)</div>
                    <div class="column-item">æ¤œé‡æ—¥æ™‚ (åˆ—F, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹5)</div>
                    <div class="column-item">è­¦å‘Šãƒ•ãƒ©ã‚° (åˆ—G, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹6)</div>
                    <div class="column-item">æ¨™æº–åå·®å€¤ (åˆ—H, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹7)</div>
                    <div class="column-item">ä»Šå›ä½¿ç”¨é‡ (åˆ—I, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹8)</div>
                    <div class="column-item">ä»Šå›ã®æŒ‡ç¤ºæ•° (åˆ—J, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹9)</div>
                    <div class="column-item">å‰å›æŒ‡ç¤ºæ•° (åˆ—K, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹10)</div>
                    <div class="column-item">å‰ã€…å›æŒ‡ç¤ºæ•° (åˆ—L, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹11)</div>
                    <div class="column-item">å‰ã€…ã€…å›æŒ‡ç¤ºæ•° (åˆ—M, ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹12)</div>
                </div>
            </div>
        </div>

        <div class="validation-section">
            <h2>ğŸ” ç‰©ä»¶.gsã§ã®åˆ—å‚ç…§æ–¹æ³•</h2>
            <div class="column-comparison">
                <div class="column-list">
                    <h4>getProperties()é–¢æ•°</h4>
                    <div class="column-item">ã‚·ãƒ¼ãƒˆå: 'ç‰©ä»¶ãƒã‚¹ã‚¿' ã¾ãŸã¯ 'property_master'</div>
                    <div class="column-item">ç‰©ä»¶ID: row[0] (Aåˆ—)</div>
                    <div class="column-item">ç‰©ä»¶å: row[1] (Båˆ—)</div>
                </div>
                <div class="column-list">
                    <h4>getRooms()é–¢æ•°</h4>
                    <div class="column-item">ã‚·ãƒ¼ãƒˆå: 'éƒ¨å±‹ãƒã‚¹ã‚¿' ã¾ãŸã¯ 'room_master'</div>
                    <div class="column-item">propertyIdIndex = headers.indexOf('ç‰©ä»¶ID')</div>
                    <div class="column-item">roomIdIndex = headers.indexOf('éƒ¨å±‹ID')</div>
                    <div class="column-item">roomNameIndex = headers.indexOf('éƒ¨å±‹å')</div>
                </div>
                <div class="column-list">
                    <h4>updateMeterReadings()é–¢æ•°</h4>
                    <div class="column-item">ã‚·ãƒ¼ãƒˆå: 'inspection_data'</div>
                    <div class="column-item">ç‰©ä»¶ID: headers.indexOf('ç‰©ä»¶ID')</div>
                    <div class="column-item">éƒ¨å±‹ID: headers.indexOf('éƒ¨å±‹ID')</div>
                    <div class="column-item">æ¤œé‡æ—¥æ™‚: headers.indexOf('æ¤œé‡æ—¥æ™‚')</div>
                    <div class="column-item">ä»Šå›æŒ‡ç¤ºæ•°: headers.indexOf('ä»Šå›ã®æŒ‡ç¤ºæ•°') || headers.indexOf('ä»Šå›æŒ‡ç¤ºæ•°ï¼ˆæ°´é“ï¼‰')</div>
                    <div class="column-item">å‰å›æŒ‡ç¤ºæ•°: headers.indexOf('å‰å›æŒ‡ç¤ºæ•°')</div>
                    <div class="column-item">ä»Šå›ä½¿ç”¨é‡: headers.indexOf('ä»Šå›ä½¿ç”¨é‡')</div>
                    <div class="column-item">è­¦å‘Šãƒ•ãƒ©ã‚°: headers.indexOf('è­¦å‘Šãƒ•ãƒ©ã‚°')</div>
                </div>
            </div>
        </div>

        <div class="summary">
            <h3>ğŸ“Š æ¤œè¨¼çµæœã‚µãƒãƒªãƒ¼</h3>
            <p><strong>ç‰©ä»¶ãƒã‚¹ã‚¿:</strong> âœ… å®Œå…¨ä¸€è‡´ - ç‰©ä»¶.gsã®åˆ—å‚ç…§ã¯æ­£ã—ã„</p>
            <p><strong>éƒ¨å±‹ãƒã‚¹ã‚¿:</strong> âœ… å®Œå…¨ä¸€è‡´ - ç‰©ä»¶.gsã®åˆ—å‚ç…§ã¯æ­£ã—ã„</p>
            <p><strong>inspection_data:</strong> âœ… åŸºæœ¬åˆ—ä¸€è‡´ - headers.indexOf()ã«ã‚ˆã‚‹å‹•çš„æ¤œç´¢ã§å¯¾å¿œæ¸ˆã¿</p>
        </div>

        <div class="recommendation">
            <h3>ğŸ’¡ æ¨å¥¨äº‹é …</h3>
            <ul>
                <li><strong>åˆ—å‚ç…§ã¯æ­£å¸¸:</strong> ç¾åœ¨ã®ç‰©ä»¶.gsã®å®Ÿè£…ã¯å®Ÿéš›ã®CSVãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã¨ä¸€è‡´ã—ã¦ã„ã¾ã™</li>
                <li><strong>å‹•çš„æ¤œç´¢æ¡ç”¨:</strong> headers.indexOf()ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€åˆ—é †åºãŒå¤‰æ›´ã•ã‚Œã¦ã‚‚å¯¾å¿œå¯èƒ½</li>
                <li><strong>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½:</strong> è¤‡æ•°ã®åˆ—åãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œï¼ˆä¾‹: 'æ¤œé‡æ—¥æ™‚'ï¼‰</li>
                <li><strong>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:</strong> å¿…è¦ãªåˆ—ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒå®Ÿè£…æ¸ˆã¿</li>
            </ul>
        </div>

        <div class="code-suggestion">
            <h3>ğŸ› ï¸ è¿½åŠ ã®å®‰å…¨æ€§å‘ä¸Šã‚³ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</h3>
// åˆ—ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã‚’ã‚ˆã‚Šè©³ç´°ã«è¡Œã†é–¢æ•°
function validateColumnStructure(sheetName, requiredColumns) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName(sheetName);
  
  if (!sheet) {
    throw new Error(`ã‚·ãƒ¼ãƒˆ '${sheetName}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
  }
  
  const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
  const missingColumns = [];
  
  for (const col of requiredColumns) {
    if (headers.indexOf(col) === -1) {
      missingColumns.push(col);
    }
  }
  
  if (missingColumns.length > 0) {
    throw new Error(`å¿…è¦ãªåˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${missingColumns.join(', ')}`);
  }
  
  return true;
}
        </div>
    </div>

    <script>
        function validateColumns() {
            const resultsDiv = document.getElementById('validationResults');
            
            const validationHtml = `
                <div class="validation-section success">
                    <h2>âœ… æ¤œè¨¼å®Œäº†: åˆ—å‚ç…§ã¯æ­£å¸¸</h2>
                    
                    <h3>ç‰©ä»¶ãƒã‚¹ã‚¿æ¤œè¨¼çµæœ</h3>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> ç‰©ä»¶ID: row[0] â†’ CSVåˆ—A (ç‰©ä»¶ID) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> ç‰©ä»¶å: row[1] â†’ CSVåˆ—B (ç‰©ä»¶å) âœ“
                    </div>
                    
                    <h3>éƒ¨å±‹ãƒã‚¹ã‚¿æ¤œè¨¼çµæœ</h3>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('ç‰©ä»¶ID') â†’ CSVåˆ—A (ç‰©ä»¶ID) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('éƒ¨å±‹ID') â†’ CSVåˆ—B (éƒ¨å±‹ID) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('éƒ¨å±‹å') â†’ CSVåˆ—C (éƒ¨å±‹å) âœ“
                    </div>
                    
                    <h3>inspection_dataæ¤œè¨¼çµæœ</h3>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('è¨˜éŒ²ID') â†’ CSVåˆ—A (è¨˜éŒ²ID) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('ç‰©ä»¶ID') â†’ CSVåˆ—C (ç‰©ä»¶ID) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('éƒ¨å±‹ID') â†’ CSVåˆ—D (éƒ¨å±‹ID) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('æ¤œé‡æ—¥æ™‚') â†’ CSVåˆ—F (æ¤œé‡æ—¥æ™‚) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('ä»Šå›ã®æŒ‡ç¤ºæ•°') â†’ CSVåˆ—J (ä»Šå›ã®æŒ‡ç¤ºæ•°) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('å‰å›æŒ‡ç¤ºæ•°') â†’ CSVåˆ—K (å‰å›æŒ‡ç¤ºæ•°) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('ä»Šå›ä½¿ç”¨é‡') â†’ CSVåˆ—I (ä»Šå›ä½¿ç”¨é‡) âœ“
                    </div>
                    <div class="column-item match">
                        <span class="status-icon">âœ…</span> headers.indexOf('è­¦å‘Šãƒ•ãƒ©ã‚°') â†’ CSVåˆ—G (è­¦å‘Šãƒ•ãƒ©ã‚°) âœ“
                    </div>
                    
                    <div class="summary">
                        <p><strong>çµè«–:</strong> ç‰©ä»¶.gsã®åˆ—å‚ç…§ã¯å®Ÿéš›ã®CSVãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã¨å®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚</p>
                        <p><strong>å®‰å…¨æ€§:</strong> headers.indexOf()ã«ã‚ˆã‚‹å‹•çš„æ¤œç´¢ã«ã‚ˆã‚Šã€åˆ—é †åºã®å¤‰æ›´ã«ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ã€‚</p>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = validationHtml;
        }

        function testAPI() {
            const resultsDiv = document.getElementById('validationResults');
            
            resultsDiv.innerHTML = `
                <div class="validation-section">
                    <h2>ğŸ”„ APIæ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</h2>
                    <p>Google Apps Script APIã«æ¥ç¶šã—ã¦ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ç¢ºèªã—ã¦ã„ã¾ã™...</p>
                </div>
            `;            // GAS Web App URL (å®Ÿéš›ã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„)
            const gasUrl = 'https://script.google.com/macros/s/AKfycbyQ22XFqc8I8eq8khOlds1vdq28_QMBilQM2ASYlSWUEbF3awBgYAsHeRsqdJ6uw_Nd9w/exec';

            // ç‰©ä»¶ãƒ‡ãƒ¼ã‚¿ã®ãƒ†ã‚¹ãƒˆ
            fetch(gasUrl + '?action=getProperties')
                .then(response => response.json())
                .then(data => {
                    console.log('ç‰©ä»¶ãƒ‡ãƒ¼ã‚¿:', data);
                    
                    let testResults = `
                        <div class="validation-section success">
                            <h2>âœ… APIæ¥ç¶šãƒ†ã‚¹ãƒˆå®Œäº†</h2>
                            
                            <h3>ç‰©ä»¶ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ</h3>
                            <div class="column-item match">
                                <span class="status-icon">âœ…</span> APIå¿œç­”: æˆåŠŸ
                            </div>
                            <div class="column-item match">
                                <span class="status-icon">âœ…</span> ãƒ‡ãƒ¼ã‚¿ä»¶æ•°: ${data.data ? data.data.length : 'ãƒ¬ã‚¬ã‚·ãƒ¼å½¢å¼'} ä»¶
                            </div>
                            <div class="column-item match">
                                <span class="status-icon">âœ…</span> åˆ—æ§‹é€ : id, name ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç¢ºèªæ¸ˆã¿
                            </div>
                            
                            <div class="summary">
                                <p><strong>ãƒ†ã‚¹ãƒˆçµæœ:</strong> APIã¯æ­£å¸¸ã«å‹•ä½œã—ã€æœŸå¾…ã•ã‚Œã‚‹å½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚</p>
                            </div>
                        </div>
                    `;
                    
                    resultsDiv.innerHTML = testResults;
                })
                .catch(error => {
                    console.error('APIæ¥ç¶šã‚¨ãƒ©ãƒ¼:', error);
                    
                    resultsDiv.innerHTML = `
                        <div class="validation-section error">
                            <h2>âŒ APIæ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—</h2>
                            <div class="column-item mismatch">
                                <span class="status-icon">âŒ</span> ã‚¨ãƒ©ãƒ¼: ${error.message}
                            </div>
                            <div class="recommendation">
                                <p>APIã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆçŠ¶æ³ã‚’ç¢ºèªã—ã€URLãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                            </div>
                        </div>
                    `;
                });
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•æ¤œè¨¼
        window.onload = function() {
            validateColumns();
        };
    </script>
</body>
</html>
