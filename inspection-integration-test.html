<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¤œé‡æ©Ÿèƒ½ä¿®æ­£ çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background-color: #fafafa;
        }
        .test-passed {
            border-left: 4px solid #4caf50;
            background-color: #f1f8e9;
        }
        .test-failed {
            border-left: 4px solid #f44336;
            background-color: #ffebee;
        }
        .test-warning {
            border-left: 4px solid #ff9800;
            background-color: #fff3e0;
        }
        .test-button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #1565c0;
        }
        .log-output {
            background: #263238;
            color: #b0bec5;
            padding: 16px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 16px 0;
        }
        .summary {
            font-size: 18px;
            font-weight: 500;
            margin: 20px 0;
            padding: 16px;
            border-radius: 4px;
        }
        .summary.success {
            background: #4caf50;
            color: white;
        }
        .summary.failure {
            background: #f44336;
            color: white;
        }
        h1, h2 {
            color: #1976d2;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 8px;
        }
        .badge.success { background: #4caf50; color: white; }
        .badge.failure { background: #f44336; color: white; }
        .badge.info { background: #2196f3; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª æ¤œé‡æ©Ÿèƒ½ä¿®æ­£ çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
        <p>
            æ¤œé‡æ—¥æ›´æ–°ã¨Force Refreshæ©Ÿèƒ½ã®ä¿®æ­£ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
        </p>
        
        <div class="test-section">
            <h2>ğŸš€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
            <button class="test-button" onclick="runAllTests()">ğŸ“‹ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="test-button" onclick="runInspectionDateTests()">ğŸ“… æ¤œé‡æ—¥ãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="runForceRefreshTests()">ğŸ”„ Force Refreshãƒ†ã‚¹ãƒˆ</button>
            <button class="test-button" onclick="clearLogs()">ğŸ§¹ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>
        
        <div id="test-summary" class="summary" style="display: none;">
            <span id="summary-text"></span>
            <span id="summary-badge" class="badge"></span>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœæ¦‚è¦</h2>
            <div id="test-results">
                <div id="date-test-result">ğŸ“… æ¤œé‡æ—¥æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯: <span class="badge info">æœªå®Ÿè¡Œ</span></div>
                <div id="refresh-test-result">ğŸ”„ Force Refreshæ©Ÿèƒ½: <span class="badge info">æœªå®Ÿè¡Œ</span></div>
                <div id="storage-test-result">ğŸ’¾ SessionStorageç®¡ç†: <span class="badge info">æœªå®Ÿè¡Œ</span></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ ä¿®æ­£å†…å®¹ç¢ºèª</h2>
            <ul>
                <li><strong>æ¤œé‡æ—¥æ›´æ–°ä¿®æ­£</strong>: handleUpdateReadingsé–¢æ•°ã§å¸¸ã«getCurrentJSTDateString()ã‚’ä½¿ç”¨</li>
                <li><strong>Force Refreshå®Ÿè£…</strong>: meter_reading.html â†’ room_select.html é–“ã§ã®ãƒ•ãƒ©ã‚°ç®¡ç†</li>
                <li><strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¤ãƒ‘ã‚¹</strong>: å¼·åˆ¶ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥æ™‚ã«SessionStorage/LocalStorageã‚’ãƒã‚¤ãƒ‘ã‚¹</li>
                <li><strong>ãƒ•ãƒ©ã‚°ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«</strong>: é©åˆ‡ãªãƒ•ãƒ©ã‚°è¨­å®šãƒ»æ¤œå‡ºãƒ»ã‚¯ãƒªã‚¢å‡¦ç†</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“‹ è©³ç´°ãƒ­ã‚°</h2>
            <div id="log-output" class="log-output">ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„...</div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”§ æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ‰‹é †</h2>
            <ol>
                <li><strong>æ¤œé‡æ—¥æ›´æ–°ãƒ†ã‚¹ãƒˆ</strong>:
                    <ul>
                        <li>æ¤œé‡æƒ…å ±ç”»é¢ã§æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°</li>
                        <li>ä¿å­˜å¾Œã€æ¤œé‡æ—¥ãŒä»Šæ—¥ã®æ—¥ä»˜ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª</li>
                    </ul>
                </li>
                <li><strong>Force Refreshãƒ†ã‚¹ãƒˆ</strong>:
                    <ul>
                        <li>éƒ¨å±‹ä¸€è¦§ã‹ã‚‰æ¤œé‡æƒ…å ±ç”»é¢ã¸ç§»å‹•</li>
                        <li>æ¤œé‡ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ãƒ»ä¿å­˜</li>
                        <li>æˆ»ã‚‹ãƒœã‚¿ãƒ³ã§éƒ¨å±‹ä¸€è¦§ã«æˆ»ã‚‹</li>
                        <li>æ¤œé‡å®Œäº†æ—¥ãŒã™ãã«åæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <script src="inspection-date-test.js"></script>
    <script src="force-refresh-test.js"></script>
    
    <script>
        let logOutput = '';
        
        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        function captureLog(level, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.join(' ');
            logOutput += `[${timestamp}] ${level}: ${message}\n`;
            updateLogDisplay();
            
            // å…ƒã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã‚‚å®Ÿè¡Œ
            if (level === 'LOG') originalConsoleLog(...args);
            else if (level === 'WARN') originalConsoleWarn(...args);
            else if (level === 'ERROR') originalConsoleError(...args);
        }
        
        console.log = (...args) => captureLog('LOG', ...args);
        console.warn = (...args) => captureLog('WARN', ...args);
        console.error = (...args) => captureLog('ERROR', ...args);
        
        function updateLogDisplay() {
            document.getElementById('log-output').textContent = logOutput;
            document.getElementById('log-output').scrollTop = document.getElementById('log-output').scrollHeight;
        }
        
        function clearLogs() {
            logOutput = '';
            updateLogDisplay();
        }
        
        function updateTestResult(testId, passed, label) {
            const element = document.getElementById(testId);
            if (element) {
                const badge = passed ? '<span class="badge success">âœ… åˆæ ¼</span>' : '<span class="badge failure">âŒ å¤±æ•—</span>';
                element.innerHTML = `${label}: ${badge}`;
            }
        }
        
        function updateSummary(allPassed, details) {
            const summaryDiv = document.getElementById('test-summary');
            const summaryText = document.getElementById('summary-text');
            const summaryBadge = document.getElementById('summary-badge');
            
            summaryDiv.style.display = 'block';
            
            if (allPassed) {
                summaryDiv.className = 'summary success';
                summaryText.textContent = 'ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼å®Ÿè£…ã•ã‚ŒãŸä¿®æ­£ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚';
                summaryBadge.textContent = 'âœ… æˆåŠŸ';
                summaryBadge.className = 'badge success';
            } else {
                summaryDiv.className = 'summary failure';
                summaryText.textContent = 'âš ï¸ ä¸€éƒ¨ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                summaryBadge.textContent = 'âŒ å¤±æ•—';
                summaryBadge.className = 'badge failure';
            }
        }
        
        function runInspectionDateTests() {
            clearLogs();
            console.log('ğŸ§ª æ¤œé‡æ—¥æ›´æ–°ãƒ†ã‚¹ãƒˆé–‹å§‹...\n');
            
            try {
                if (typeof window.runAllInspectionTests === 'function') {
                    const result = window.runAllInspectionTests();
                    updateTestResult('date-test-result', result, 'ğŸ“… æ¤œé‡æ—¥æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯');
                    return result;
                } else {
                    console.error('æ¤œé‡æ—¥ãƒ†ã‚¹ãƒˆé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return false;
                }
            } catch (error) {
                console.error('æ¤œé‡æ—¥ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
                return false;
            }
        }
        
        function runForceRefreshTests() {
            console.log('\nğŸ§ª Force Refreshãƒ†ã‚¹ãƒˆé–‹å§‹...\n');
            
            try {
                if (typeof window.runForceRefreshTests === 'function') {
                    const result = window.runForceRefreshTests();
                    updateTestResult('refresh-test-result', result, 'ğŸ”„ Force Refreshæ©Ÿèƒ½');
                    return result;
                } else {
                    console.error('Force Refreshãƒ†ã‚¹ãƒˆé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return false;
                }
            } catch (error) {
                console.error('Force Refreshãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
                return false;
            }
        }
        
        function runStorageTests() {
            console.log('\nğŸ§ª SessionStorageãƒ†ã‚¹ãƒˆé–‹å§‹...\n');
            
            try {
                if (typeof window.runSessionStorageTests === 'function') {
                    const result = window.runSessionStorageTests();
                    const passed = result.setTest && result.clearTest;
                    updateTestResult('storage-test-result', passed, 'ğŸ’¾ SessionStorageç®¡ç†');
                    return passed;
                } else {
                    console.error('SessionStorageãƒ†ã‚¹ãƒˆé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return false;
                }
            } catch (error) {
                console.error('SessionStorageãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
                return false;
            }
        }
        
        function runAllTests() {
            clearLogs();
            console.log('ğŸš€ æ¤œé‡æ©Ÿèƒ½ä¿®æ­£ çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹');
            console.log('=' .repeat(50));
            
            const dateTestResult = runInspectionDateTests();
            const refreshTestResult = runForceRefreshTests(); 
            const storageTestResult = runStorageTests();
            
            console.log('\n' + '='.repeat(50));
            console.log('ğŸ¯ çµ±åˆãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼');
            console.log('=' .repeat(50));
            
            const allPassed = dateTestResult && refreshTestResult && storageTestResult;
            
            console.log(`ğŸ“… æ¤œé‡æ—¥æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯: ${dateTestResult ? 'âœ… åˆæ ¼' : 'âŒ å¤±æ•—'}`);
            console.log(`ğŸ”„ Force Refreshæ©Ÿèƒ½: ${refreshTestResult ? 'âœ… åˆæ ¼' : 'âŒ å¤±æ•—'}`);  
            console.log(`ğŸ’¾ SessionStorageç®¡ç†: ${storageTestResult ? 'âœ… åˆæ ¼' : 'âŒ å¤±æ•—'}`);
            
            console.log(`\nğŸ‰ ç·åˆçµæœ: ${allPassed ? 'âœ… å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼' : 'âŒ ä¸€éƒ¨ãƒ†ã‚¹ãƒˆå¤±æ•—'}`);
            
            updateSummary(allPassed, {
                dateTest: dateTestResult,
                refreshTest: refreshTestResult,
                storageTest: storageTestResult
            });
            
            if (allPassed) {
                console.log('\nâœ¨ å®Ÿè£…ã•ã‚ŒãŸä¿®æ­£ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼');
                console.log('ğŸ“ ä¿®æ­£å†…å®¹:');
                console.log('  1. æ¤œé‡æ—¥æ›´æ–°æ™‚ã«å¸¸ã«ä»Šæ—¥ã®æ—¥ä»˜ãŒè¨­å®šã•ã‚Œã‚‹');
                console.log('  2. æ¤œé‡å®Œäº†å¾Œã®éƒ¨å±‹ä¸€è¦§æˆ»ã‚Šæ™‚ã«ãƒ‡ãƒ¼ã‚¿ãŒå³åº§ã«åæ˜ ã•ã‚Œã‚‹');
                console.log('  3. SessionStorageãƒ•ãƒ©ã‚°ãŒé©åˆ‡ã«ç®¡ç†ã•ã‚Œã‚‹');
                console.log('  4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¤ãƒ‘ã‚¹ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹');
            }
            
            return allPassed;
        }
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è»½é‡ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('ğŸ“‹ ãƒ†ã‚¹ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆæœŸåŒ–å®Œäº†');
                console.log('â–¶ï¸ å³ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
            }, 500);
        });
    </script>
</body>
</html>